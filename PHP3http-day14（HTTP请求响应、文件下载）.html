<html>
<head>
  <title>PHP3http-day14（HTTP请求响应、文件下载）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303788 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1429"/>
<h1>PHP3http-day14（HTTP请求响应、文件下载）</h1>

<div>
<span><div><span style="font-size: 19px;">PHP3http-day14（HTTP请求响应、文件下载）</span></div><div align="justify" style="font-weight: bold; font-size: 15px;"><font color="#010101" face="Times New Roman" size="4"><span style="font-size:16pt"><b>一<span style="font-size: 19px;">、B/S</span></b></span></font><span style="font-size: 19px;"><font color="#010101" face="宋体"><b>网络结构</b></font></span></div><div align="justify"><div align="justify" style="min-height: 14pt;"><div style="margin-left:40px;"><font color="#0000FF" face="Times New Roman" size="2"><span style="font-size:10pt">PHP</span></font><font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">没有兼容性，浏览器才有兼容性。</span></font></div></div></div><div align="justify" style="margin-left:40px;"><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);">Browser-&gt;HTTP请求&gt;-------&lt;</span></span><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);">HTTP响应&lt;-</span></span><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);">-Server</span></span><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);">--&gt;SQL请求&gt;-------&lt;</span></span><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);">SQL响应&lt;数据库服务器</span></span></div><div align="justify"><div align="justify" style="min-height: 14pt;"><div><span style="font-size: 19px;"><b><font face="Times New Roman">二、HTTP</font><font face="宋体">超文本传输协议</font></b><font color="#010101" face="宋体">。</font></span><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">HTTP</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">是浏览网络资源的一种</span></font><font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">标准</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">。一种上网的标准</span></font></div><div>     特点：简单（<font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">HTTP</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">发送的内容主要是</span></font><font color="#FF0000" face="宋体" size="2"><span style="font-size:10pt">请求方法</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">和</span></font><font color="#FF0000" face="宋体" size="2"><span style="font-size:10pt">请求资源的地址</span></font>），无连接、无状态（没有记忆状态）</div><div><div align="justify" style="min-height: 14pt;"><div><b><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt"><span style="font-size: 19px;">三、URL</span>(Uniform Resource Locator)</span></font></b><font color="#010101" face="宋体" size="2"><span style="font-size:10pt"><b>统一资源定位符。</b>对互联网上文件访问的一种方式。</span></font></div></div><div align="justify" style="min-height: 18pt;"><div><span style="font-size: 16px;"><font color="#010101" face="Times New Roman"><b>1</b></font><font color="#010101" face="宋体"><b>、</b></font><font color="#010101" face="Times New Roman"><b>URL</b></font><font color="#010101" face="宋体"><b>的构成</b></font></span></div><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">          语法：</span></font><b><font face="Times New Roman" size="2"><span style="font-size:10pt">protocol://host[:port]/directory/filename?name=value#anchor</span></font></b></div></div><ul style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;list-style-type: disc;"><li style="display:inline;list-style:none;"><ul><li style="display:inline;list-style:none;"><ul><li style="list-style-type: none;">协议 主机名 端口号 目录名 文件名  传参        锚点名（#top,#red）</li></ul></li></ul></li></ul></div><div align="justify" style="min-height: 14pt;"><div><span style="font-size: 16px;"><b><font color="#010101" face="Times New Roman">2、HTTP</font></b><font color="#010101" face="宋体"><b>请求</b>由三个部分构成：</font><font color="#0000FF" face="宋体">请求行</font><font color="#010101" face="宋体">、</font><font color="#0000FF" face="宋体">请求头信息</font><font color="#010101" face="宋体">、</font><font color="#0000FF" face="宋体">请求的主体</font></span></div></div><div align="justify" style="min-height: 18pt;"><div><font color="#010101" face="宋体"><b>   <span style="font-size: 16px;">2.1请求行的格式</span></b></font></div><div>         <span style="font-family: 宋体;"> 格式：请求方法  请求资源的URI  HTTP协议版本号-----例GET/yao.php HTTP/1.1</span></div></div><div style="margin-left: 15pt; margin-right: 0pt; padding-left: 3pt; text-indent: 0pt;"><div><span style="color: rgb(1, 1, 1);"><span style="font-family: 宋体;"><span style="color: rgb(0, 0, 255);">     1、GET/POST  2、<b>URI</b>（统一资源标识符）3、版本</span></span></span></div><div><span style="color: rgb(1, 1, 1);"><span style="font-family: 宋体;"><span style="color: rgb(0, 0, 255);">注意</span></span></span>URL(统一资源定位符)：http://www.2016.cn<b>/abc/yao.htm</b>l和<span style="text-indent: 0pt;"><b>URI</b>(统一资源标识符)<b>/abc/yao.html</b>区别</span></div><div>       2.1.1<font color="#010101" face="Times New Roman"><b>GET</b></font><font color="#010101" face="宋体"><b>和</b></font><font color="#010101" face="Times New Roman"><b>POST</b></font><font color="#010101" face="宋体"><b>区别（补充）：</b></font><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">HTTP</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">协议本身，</span></font><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">GET</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">方式和</span></font><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">POST</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">方式</span></font><font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">都没有大小限制</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">，但浏览器本身对GET有限制大小</span></font><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">(2083b)</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">，</span></font><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">POST</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">方式</span></font><font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">没有大小限制</span></font></div></div><div align="justify" style="min-height: 18pt;"><div><font color="#010101" size="4"><b><font face="Times New Roman"><span style="font-size: 14pt;">     </span><span style="font-family: 宋体;">2.2</span></font><span style="font-family: 宋体;">请求头含义</span></b></font><span style="font-size: 16px;"><span style="font-family: 宋体;"><font color="#010101"><b>Response Headers</b></font></span></span></div></div><div style="margin-left:40px;"><b>Host: <a href="http://www.2016.cn/">www.2016.cn</a></b> ------》 请求的<b><span style="color: rgb(0, 0, 255);">主机名称</span></b></div><div style="margin-left:40px;">//用户代理：将你的机器告诉服务器</div><div style="margin-left:40px;"><b>User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0</b></div><div style="margin-left:40px;">//告诉服务器，浏览器可以接收什么类型的文件</div><div style="margin-left:40px;"><b>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</b></div><div style="margin-left:40px;">//告诉服务器，你可以接收什么语言</div><div style="margin-left:40px;"><b>Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</b></div><div style="margin-left:40px;">//告诉服务器，可以接收什么样的压缩格式</div><div style="margin-left:40px;"><b>Accept-Encoding: gzip, deflate</b></div><div style="margin-left:40px;">//连接类型：长连接和短连接。</div><div style="margin-left:40px;"><b>Connection: keep-alive</b></div><div align="justify" style="min-height: 18pt;"><div><span style="font-size: 16px;"><font color="#010101" face="Times New Roman"><b>    <span style="font-family: 宋体;"> 2.3</span></b></font><span style="font-family: 宋体;"><font color="#010101"><b>请求主体</b></font></span></span></div></div><div align="justify" style="min-height: 14pt;"><div><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">               GET</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">方式没有请求的主体，只有</span></font><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">POST</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">方式才有主体数据</span></font></div><div align="justify" style="min-height: 18pt;"><div><font color="#010101" size="4"><span style="font-size: 14pt;"><b><font face="Times New Roman">2.4</font><font face="宋体">带有附件的</font></b></span></font><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>http</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>请求头</b></span></font></div><div style="margin-left:40px;"><b><span style="font-size: 14pt;"><span style="font-family: 宋体;"><span style="color: rgb(1, 1, 1);">&lt;form name=&quot;form1&quot; method=&quot;post&quot; <span style="color: rgb(255, 0, 0);">enctype=&quot;multipart/form-data&quot;</span> action=&quot;&quot;&gt;</span></span></span></b></div><div align="justify" style="min-height: 14pt;"><div style="margin-left:40px;"><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">在一个网页有两张图片，需要几次</span></font><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">HTTP</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">请求？3次</span></font></div></div></div></div><div><img src="PHP3http-day14（HTTP请求响应、文件下载）_files/Image.png" type="image/png" style="height: auto;"/></div><div align="left" style="min-height: 12pt;"><div><font face="΢���ź�" size="1"><span style="font-size:9pt">// 获取一个GMT格式的时间</span></font><font face="΢���ź�" size="1"><span style="font-size:9pt">            echo gmstrftime(&quot;%b %d %Y %H:%M:%S&quot;, time()).' GMT';</span></font></div></div><div><h3 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>防盗链</b></span></font></h3><div align="justify" style="min-height: 18pt;"><div><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>1</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>、</b></span></font><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>Refrerer</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>的概述</b></span></font></div></div><div align="justify" style="min-height: 14pt;"><div><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">Refrerer</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">是一个</span></font><font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">请求的头</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">信息，记录了当前用户，是从</span></font><font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">哪个页面链接过来</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">的。</span></font><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">--</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">注意就是要判断跳转前网站是不是自己的</span></font></div></div><div align="justify" style="min-height: 14pt;"><div>文件下载的防盗,电商安全验证,统计网站路由</div><div>什么情况下获取不到Referer</div><div>1、直接在地址栏输入网址，浏览器不会发送Referer</div><div>2、从收藏夹打开网址，浏览器不会发送Referer</div><div>3、从HTTPS的网站跳转到HTTP的网站时，浏览器是不会发送Referrer的。</div></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="color: rgb(51, 51, 51);">if (isset(<span style="color: rgb(255, 0, 0);">$_SERVER['HTTP_REFERER']</span>)) {</span></div><div><span style="color: rgb(51, 51, 51);">        if(strpos($_SERVER['HTTP_REFERER'], &quot;http://www.wdc.com/PHPlianxi&quot;)===0)</span></div><div><span style="color: rgb(51, 51, 51);">            {   echo &quot;可以下载&quot;;</span></div><div><span style="color: rgb(51, 51, 51);">            }else{ echo &quot;非法盗链&quot;;   }</span></div><div><span style="color: rgb(51, 51, 51);">    } else {   echo &quot;非法操作&quot;;   }</span></div></div><div><b><font color="#010101" face="Times New Roman" size="4"><span style="font-size:16pt"><b>四、HTTP</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt">协议详解之响应篇</span></font></b></div><div align="justify" style="min-height: 18pt;"><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>1</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>、</b></span></font><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>HTTP</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>响应的构成</b></span></font></div><div align="justify" style="min-height: 13pt;"><div><font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">语法：状态行</span></font><font color="#0000FF" face="Times New Roman" size="2"><span style="font-size:10pt"> </span></font> <font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">响应头部</span></font><font color="#0000FF" face="Times New Roman" size="2"><span style="font-size:10pt"> </span></font> <font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">响应体</span></font></div></div><div align="justify" style="min-height: 18pt;"><div><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>2</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>、状态行的格式</b></span></font></div></div><div align="justify" style="min-height: 13pt;"><div><font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">语法：协议版本</span></font><font color="#0000FF" face="Times New Roman" size="2"><span style="font-size:10pt"> </span></font> <font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">状态码</span></font><font color="#0000FF" face="Times New Roman" size="2"><span style="font-size:10pt">  </span></font> <font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">状态文本描述---例HTTP/1.1 200 OK</span></font></div></div><div align="justify" style="min-height: 18pt;"><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>3</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>、状态码的含义</b></span></font></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">状态码是由</span></font><font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt">三位数字</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">构成，第一位数字定义了响应的类型。</span></font></div><div><img src="PHP3http-day14（HTTP请求响应、文件下载）_files/Image [1].png" type="image/png" style="height: auto;"/></div></div><div><img src="PHP3http-day14（HTTP请求响应、文件下载）_files/Image [2].png" type="image/png" style="height: auto;"/></div><div align="justify" style="min-height: 18pt;"><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>4</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>、响应报头含义</b></span></font></div><div align="justify" style="min-height: 170pt;"><div><img src="PHP3http-day14（HTTP请求响应、文件下载）_files/Image [3].png" type="image/png" style="height: auto;"/></div></div><div><b>HTTP/1.1 200 OK               </b>//响应状态行</div><div><b>Date: Mon, 30 May 2016 08:04:07 GMT               </b>//请求的时间</div><div><b>Server: Apache/2.2.22 (Win32) PHP/5.3.13        </b>//告诉客户端服务器的相关信息</div><div><b>X-Powered-By: PHP/5.3.13</b></div><div><b>Content-Length: 25            </b> //内容的长度</div><div><b>Keep-Alive: timeout=5, max=100                     </b> //连接保持多长时间后断后</div><div><b>Connection: Keep-Alive     </b>//连接类型:保持连接</div><div><b>Content-Type: text/html     </b>//返回客户端文件类型</div><div align="justify" style="min-height: 18pt;"><div><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>5</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>、响应头域</b></span></font><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>Refresh</b></span></font></div><div style="margin-left:40px;"><b>header(&quot;refresh:5;url=test.html&quot;);定时跳转</b><b>header(&quot;refresh:5);//服务端刷新</b></div><div style="margin-left:40px;"><b>header('location:test.html');</b></div></div><div><b><span style="color: rgb(1, 1, 1);">          &lt;meta http-equiv=&quot;refresh&quot; content=&quot;5;test.html&quot;&gt;//客户端刷新<br/></span></b></div><div><span style="color: rgb(1, 1, 1);"><b>          &lt;script&gt;location.href=&quot;test.html&quot;&lt;/script&gt;</b><br/></span></div><div><h3 align="justify"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>6、使用</b></span></font><font color="#010101" face="Times New Roman" size="4"><span style="font-size:16pt"><b>header()</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>函数禁用缓存</b></span></font></h3><ul style="margin-top: 0mm; margin-bottom: 0mm; margin-left: 0mm; padding-left: 0pt;list-style-type: disc;"><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 3pt; text-indent:0pt; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 14pt;"><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt; font-family:Times New Roman; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">Expires</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">：设置网页缓存的过期时间，格式是</span></font><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">GMT</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">。</span></font></div></li><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 3pt; text-indent:0pt; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 14pt;"><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt; font-family:Times New Roman; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">Cache-Control</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">：</span></font><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">HTTP/1.1</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">提供的。</span></font></div></li><li style="margin-left: 15pt; margin-right: 0pt; padding-left: 3pt; text-indent:0pt; font-size: 10pt; color: #010101;"><div align="justify" style="min-height: 14pt;"><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt; font-family:Times New Roman; color:#010101; font-weight:Normal; font-style:Normal; font-decoration:Normal">Pragma</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">：兼容</span></font><font color="#010101" face="Times New Roman" size="2"><span style="font-size:10pt">HTTP/1.0</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">。不同浏览器支持不同的选项。</span></font><font color="#FF0000" face="宋体" size="2"><span style="font-size:10pt">为了所有浏览器都能生效，这两个选项都使用</span></font><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">。</span></font></div></li></ul></div><div><b><span style="color: rgb(1, 1, 1);">    $gmt=gmstrftime(&quot;%b %d %Y %H:%M:%S &quot;,time()+30).'GMT';//</span></b><font face="΢���ź�" size="1"><span style="font-size:9pt">获取一个GMT格式的时间</span></font></div><div><b><span style="color: rgb(1, 1, 1);">header(&quot;Expires:$gmt);</span></b></div><div><b><span style="color: rgb(1, 1, 1);">禁用浏览器缓存</span></b></div><div><b><span style="color: rgb(1, 1, 1);">    header(&quot;Expires:-1&quot;);</span></b></div><div><b><span style="color: rgb(1, 1, 1);">    header(&quot;Cache-Control:no-cache&quot;);</span></b></div><div><b><span style="color: rgb(1, 1, 1);">    header(&quot;Pragma:no-cache&quot;);</span></b></div><div align="justify" style="font-weight: bold; font-size: 15px;"><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>五、下载文件的</b></span></font><font color="#010101" face="Times New Roman" size="4"><span style="font-size:16pt"><b>HTTP</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:16pt"><b>响应头</b></span></font></div><div align="justify" style="min-height: 18pt;"><div><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>1</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>、</b></span></font><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>Cotent-Type:application/octet-stream//例：</b></span></font>header(&quot;Content-Disposition:attachment;filename=文件名&quot;);</div></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">描述：设置响应头为八进制的数据流。</span></font></div></div><div><b><span style="color: rgb(1, 1, 1);">header(&quot;Content-Type:application/octet-stream&quot;);//声明响应头为：八进制数据流（进制数据）</span></b></div><div align="justify" style="min-height: 18pt;"><div><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>2</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>、</b></span></font><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>Accept-Ranges:bytes断点续传---</b></span></font><font color="#0000FF" face="宋体" size="2"><span style="font-size:10pt; font-family:����; color:#0000ff; font-weight:Normal; font-style:Normal; font-decoration:Normal">提示：服务器首先要配置断点续传的功能。</span></font></div></div><div align="justify" style="min-height: 18pt;"><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>3</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>、</b></span></font><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>Accept-Length:filesize</b></span></font></div><div align="justify" style="min-height: 13pt;"><div><font color="#010101" face="宋体" size="2"><span style="font-size:10pt">描述：告诉客户端文件的大小。如果客户端数据下载完成，要进行数据大小的比对。</span></font></div><div align="justify" style="min-height: 18pt;"><div><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>4</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>、</b></span></font><font color="#010101" face="Times New Roman" size="4"><span style="font-size:14pt"><b>Content-Disposition:attachment;filename=</b></span></font><font color="#010101" face="宋体" size="4"><span style="font-size:14pt"><b>文件名</b></span></font>//告诉浏览器文件下载方式，以及下载的文件名</div></div></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">//下载函数七步骤</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    function doDownload($fileName){       </span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        header('Expires：-1');          // 禁止缓存</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        header('Cache-Control:no-cache');//禁止缓存兼容旧版本</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        header('Pragma:no-cache');       //禁止缓存兼容旧版本</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        header('Content-type:application/octet-stream');  //1、设置响应头为八进制数据流       </span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        header('Content-Transfer-Encoding: binary'); //2、告诉浏览器传送数据编码方式为2进制       </span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        header('Accept-Ranges:bytes');               //3、支持断点续传  需要服务器支持断点续传功能       </span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        $fileSize = filesize($fileName);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        header(&quot;Accept-Length:$fileSize&quot;);           //4、告诉客户端文件大小       </span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        // 取出文件名中的空格</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        $tmpName = str_replace(' ', '-', $fileName);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        $tmpName = str_replace('　', '-', $tmpName);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        $tmpName = explode('/', $tmpName);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        $tmpName = array_pop($tmpName);</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        header(&quot;Content-Disposition:attachment;filename=$tmpName&quot;); // 5、告诉浏览器文件下载方式,以及下载的文件名       </span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        ob_end_clean(); // 清空前面的输出（这一步不可忘）       </span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        $handle = fopen($fileName, 'rb');           //6、输出文件流</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        while($con = fread($handle, 1024)){</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">            echo $con;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        }</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        fclose($handle);                            //7、关闭文件流</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    }</span></span></span></div></div></div></div></span>
</div></body></html> 