<html>
<head>
  <title>PHP进阶-Ajax-Json，jQuery封装的ajax，无刷新提交表单文件进度条，地市三级联动</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303788 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2177"/>
<h1>PHP进阶-Ajax-Json，jQuery封装的ajax，无刷新提交表单文件进度条，地市三级联动</h1>

<div>
<span><div><b><span style="font-size: 21px;">PHP进阶-Ajax-Json，</span></b><b><span style="font-size: 19px;">jQuery封装的ajax，无刷新提交表单文件进度条，地市三级联动</span></b></div><div> json: <b>j</b>ava<b>s</b>cript  <b>o</b>bject  <b>n</b>otation（javascript对象符号）</div><div align="justify" style="min-height: 14pt;"><div><font color="#333333" face="黑体" size="2"><span style="font-size:10pt">其是一种</span><span style="font-size:10pt; background:#00ffff">数据交换格式</span></font><font color="#333333" face="Courier New" size="2"><span style="font-size:10pt">(</span></font><font color="#333333" face="黑体" size="2"><span style="font-size:10pt">之前的</span></font><font color="#333333" face="Courier New" size="2"><span style="font-size:10pt">xml</span></font><font color="#333333" face="黑体" size="2"><span style="font-size:10pt">也是数据交换格式</span></font><font color="#333333" face="Courier New" size="2"><span style="font-size:10pt">)</span></font><font color="#333333" face="黑体" size="2"><span style="font-size:10pt">。</span></font></div></div><div><b><span style="font-size: 19px;">一、使用XML的方式传输数据</span></b></div><div>    通过responseXML返回DOM对象</div><div>    调用getElementsByTagName获取节点信息</div><div>    注意：需要找到文本节点         对于文本节点可以通过nodeValue访问</div><div><b><span style="font-size: 19px;">二、使用JSON的方式传输数据</span></b></div><div>    <span style="font-size: 16px;"><b>2.1 JSON格式的组织形式</b></span>：“键-值”对 name:value，使用{}表示一个json对象，使用[]表示json对象数组</div><div><span style="font-size: 16px;"><font color="#333333" face="Courier New">json</font><font color="#333333" face="黑体">在</font><font color="#333333" face="Courier New">javascript</font><font color="#333333" face="黑体">里边就是<span style="background-color: rgb(0, 255, 255); background-position: initial initial; background-repeat: initial initial;">字面量对象</span></font>  <b><font color="#333333" face="Courier New">var obj = {</font><font color="#333333" face="黑体">名称</font><font color="#333333" face="Courier New">:</font><font color="#333333" face="黑体">值，名称</font><font color="#333333" face="Courier New">:</font><font color="#333333" face="黑体">值，名称</font><font color="#333333" face="Courier New">:function(){}}</font></b></span></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">var customer={firstName:'John',lastName:'Doe'};以上赋值语句的右边是一个<b>对象字面量</b>（object literal）。</span></span></div><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">对象字面量是一个名值对列表，每个名值对之间用逗号分隔，并用一个大括号括起。各名值对表示对象的一个属性，名和值这两部分之间用一个冒号分隔。</span></span> <span style="color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-style: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">在编程语言中，<b>字面量</b>是一种表示值的记法。</span></div></div><div align="justify" style="min-height: 14pt;"><div style="margin-left:40px;"><span style="color: rgb(51, 51, 51); font-family: Arial; font-style: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">JSON和XML一样也是一种简单文本格式。<b>相对于XML，JSON</b>更加易读、更便于肉眼检查。</span></div><div style="margin-left:40px;"><span style="color: rgb(51, 51, 51); font-family: Arial; font-style: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none; display: inline !important;">在语法的层面上，JSON与其他格式的区别是在于分隔数据的字符，JSON中的分隔符限于单引号<b>'</b>、小括号<b>()</b>、中括号<b>[]</b>、大括号<b>{}</b>、冒号:和逗号<b>,</b>。</span></div></div><div><span style="font-size: 16px;">  <b>  2.2 <span style="color: rgb(255, 0, 0);">PHP解析JSON</span></b></span></div><div>        json_encode      将数组/对象转换成json对象</div><div>               json_encode(关联数组/索引关联数组/对象)---》json对象，json_encode(索引数组)---》json数组</div><div>        json_decode</div><div>            反编码json，返回数组或对象，默认false对象</div><div align="justify" style="min-height: 10pt;"><div><font color="#333333" size="2"><span style="font-size:10pt"><span style="font-family: 'Courier New';">     </span><span style="font-size: 16px;">json_decode(json,</span></span><span style="font-size: 16px;"><b>true</b>)---&gt;array，</span></font><span style="font-size: 16px;"><font color="#333333">json_decode(json,<b>false</b>)---&gt;object</font></span></div></div><div><b>    <span style="font-size: 16px;">2.3 <span style="color: rgb(255, 0, 0);">JS解析JSON</span></span></b></div><div>        通过<b>eval()</b>将字符串变成JSON对象,或者.符号直接当数组用</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, 'Courier New', monospace; font-size: 12px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="color: rgb(51, 51, 51);">  <b>  $color=array('red','blue','green');</b></span></div><div><span style="color: rgb(51, 51, 51);">    echo <b>json_encode($color);</b>echo &quot;&lt;hr&gt;&quot;;<b>//1索引数组--》json数组</b></span></div><div><span style="color: rgb(51, 51, 51);">  <b>  $city=array('liaoning' =&gt; 'shenyang', 'zhejiang' =&gt; 'hangzhou','qinghai' =&gt; 'qinghaihu');</b></span></div><div><span style="color: rgb(51, 51, 51);">    echo json_encode($city);echo &quot;&lt;hr&gt;&quot;;<b>//2关联数组--》json对象</b></span></div><div><span style="color: rgb(51, 51, 51);">    <b>$city2=array('liaoning' =&gt; 'shenyang', 'zhejiang' =&gt; 'hangzhou','beijing','青海' =&gt; '青海湖','yichun');</b></span></div><div><span style="color: rgb(51, 51, 51);">    echo json_encode($city2);echo &quot;&lt;hr&gt;&quot;;<b>//3索引关联数组--》json对象</b></span></div><div><span style="color: rgb(51, 51, 51);"><b>    class Person{</b></span></div><div><span style="color: rgb(51, 51, 51);"><b>        var $name=&quot;tom&quot;;</b></span></div><div><span style="color: rgb(51, 51, 51);"><b>        var $height=&quot;170&quot;;</b></span></div><div><span style="color: rgb(51, 51, 51);"><b>        function run(){</b></span></div><div><span style="color: rgb(51, 51, 51);"><b>            echo $this&gt;name.&quot;在跑步&quot;;</b></span></div><div><span style="color: rgb(51, 51, 51);"><b>        }</b></span></div><div><span style="color: rgb(51, 51, 51);"><b>    }</b></span></div><div><span style="color: rgb(51, 51, 51);"><b>    $pers=new Person();</b></span></div><div><span style="color: rgb(51, 51, 51);">    echo json_encode($pers);echo &quot;&lt;hr&gt;&quot;;<b>//4对象json_encode--》json对象</b></span></div><div><span style="color: rgb(51, 51, 51);">    <b>$xinxi=array('name' =&gt; '张三','addr' =&gt; '浙江','年龄' =&gt; 20,'未婚','博士');</b></span></div><div><span style="color: rgb(51, 51, 51);">    $jn_xinxi=json_encode($xinxi,JSON_UNESCAPED_UNICODE);</span></div><div><span style="color: rgb(51, 51, 51);">    echo $jn_xinxi;echo &quot;&lt;hr&gt;&quot;;<b>//5中文\u加两十六进制，但加该参数可正常显示</b></span></div><div><span style="color: rgb(51, 51, 51);">    $fan_xinxi=<b>json_decode($jn_xinxi,true)</b>;</span></div><div><span style="color: rgb(51, 51, 51);">    var_dump($fan_xinxi);<b>//6返回数组或对象，默认false对象</b></span></div></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div>结果：1---------------------------------------------------------------------------------------------</div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">[&quot;red&quot;,&quot;blue&quot;,&quot;green&quot;]</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">2--------------------------------------------------------------------------------------</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">{&quot;liaoning&quot;:&quot;shenyang&quot;,&quot;zhejiang&quot;:&quot;hangzhou&quot;,&quot;qinghai&quot;:&quot;qinghaihu&quot;}</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">3--------------------------------------------------------------------------------------</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">{&quot;liaoning&quot;:&quot;shenyang&quot;,&quot;zhejiang&quot;:&quot;hangzhou&quot;,&quot;0&quot;:&quot;beijing&quot;,&quot;\u9752\u6d77&quot;:&quot;\u9752\u6d77\u6e56&quot;,&quot;1&quot;:&quot;yichun&quot;}</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">4--------------------------------------------------------------------------------------</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">{&quot;name&quot;:&quot;tom&quot;,&quot;height&quot;:&quot;170&quot;}</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">5--------------------------------------------------------------------------------------</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">{&quot;name&quot;:&quot;张三&quot;,&quot;addr&quot;:&quot;浙江&quot;,&quot;年龄&quot;:20,&quot;0&quot;:&quot;未婚&quot;,&quot;1&quot;:&quot;博士&quot;}</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">6--------------------------------------------------------------------------------------</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">array(5) { [&quot;name&quot;]=&gt; string(6) &quot;张三&quot; [&quot;addr&quot;]=&gt; string(6) &quot;浙江&quot; [&quot;年龄&quot;]=&gt; int(20) [0]=&gt; string(6) &quot;未婚&quot; [1]=&gt; string(6) &quot;博士&quot; }</span></span></span></div></div><div><span style="font-size: 19px;"><b>三、无刷新表单，详见<span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">示例345</span></span></b></span></div><div>    使用FormData对象接收表单数据（是h5新技术）<font color="#0000FF" face="黑体" size="2"><span style="font-size:10pt">普通表单域</span></font> <font color="#333333" face="黑体" size="2"><span style="font-size:10pt">和</span></font> <font color="#0000FF" face="黑体" size="2"><span style="font-size:10pt">上传文件域</span></font> <font color="#333333" face="黑体" size="2"><span style="font-size:10pt">均可以收集。</span></font>几个注意事项</div><div style="margin-left:40px;">var fd = new FormData(this);  //1表单的<b>全部信息</b>已经收集给fd存储了</div><div style="margin-left:40px;">//2使用FormData的时候，不用使用setRequestHeader()方法</div><div style="margin-left:40px;">xhr.send(fd); //3post提交表单信息</div><div style="margin-left:40px;">evt.preventDefault();//4使用事件方法阻止表单form数据提交动作</div><div><b><span style="font-size: 19px;">四、无刷新上传，详见<span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">示例345</span></span></span></b></div><div>    使用FormData对象接收表单数据</div><div>    进度条的实现</div><div>        通过upload对象的</div><div>            onprogress事件</div><div>                loaded     已经上传文件</div><div>                total        总文件大小</div><div><b><span style="font-size: 19px;">五、jQuery封装的ajax的使用，详见<span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">示例345</span></span></span></b></div><div>    5.1     <span style="font-size: 16px;"><b><font color="#333333" face="Courier New">$.</font><font color="#0000FF" face="Courier New">get</font><font color="#333333" face="Courier New">(url[,data][,function(<span style="background-color: rgb(0, 255, 255); background-position: initial initial; background-repeat: initial initial;">msg</span>){}</font><font color="#333333" face="黑体">回调函数</font><font color="#333333" face="Courier New">][, dataType]);</font></b></span></div><div>        url             请求地址</div><div>        data             数据参数，<font color="#333333" face="黑体" size="2"><span style="font-size:10pt">给服务器传递的数据，</span><span style="font-size:10pt; background:#00ffff">请求字符串</span></font> <font color="#333333" face="黑体" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" face="Courier New" size="2"><span style="font-size:10pt; background:#00ffff">json</span></font><font color="#333333" face="黑体" size="2"><span style="font-size:10pt; background:#00ffff">对象</span></font> <font color="#333333" face="黑体" size="2"><span style="font-size:10pt">都可以设置</span></font></div><div>        callback             回调函数，完成ajax后续处理，<font color="#333333" face="Courier New" size="2"><span style="font-size:10pt"><b>msg</b></span></font><font color="#333333" face="黑体" size="2"><span style="font-size:10pt">泛指从服务器传递回来数据信息的变量</span></font></div><div align="justify" style="min-height: 14pt;"><div><font color="#333333" size="2"><span style="font-size:10pt">        dataType</span></font><font color="#333333" size="2"><span style="font-size:10pt">：服务器返回数据类型，</span></font><font color="#333333" size="2"><span style="font-size:10pt">html</span></font><font color="#333333" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" size="2"><span style="font-size:10pt">text</span></font><font color="#333333" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" size="2"><span style="font-size:10pt">xml</span></font><font color="#333333" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" size="2"><span style="font-size:10pt">json</span></font></div></div><div>    5.2     <span style="font-size: 16px;"><b><font color="#333333" face="Courier New">$.</font><font color="#0000FF" face="Courier New">post</font><font color="#333333" face="Courier New">(url[,data][,fn</font><font color="#333333" face="黑体">回调函数</font><font color="#333333" face="Courier New">][, dataType]);</font></b></span></div><div>        url             请求地址</div><div>        data          数据参数</div><div>        callback       回调函数</div><div>        dataType     返回数据类型</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>4.10 21:55 //此处插播一条注意事项</div><div>项目第14次提交</div><div>1短信验证码功能</div><div>BUG:短信验证码这里卡了4.8个小时,短信可接收,但短信发送状态不显示</div><div>原因:Ajax接收返回的数据不正确,多返回了Sending TemplateSMS to $to &lt;br/&gt;{ status=&quot;100&quot;}</div><div>解决:修改function()里function sendSms($to,$datas,$tempId='1'){}函数</div><div>将echo &quot;Sending TemplateSMS to $to &lt;br/&gt;&quot;;注释掉后正确返回{&quot;status&quot;:&quot;101&quot;}</div><div><span style="color: rgb(255, 0, 0);">注意</span>:以后使用Ajax返回的数据只能纯json,并<span style="color: rgb(255, 0, 0);">注意调用接口时有没有返回接口函数中的无关数据</span></div></div><div>    5.3     $.ajax-----详见示例5.1地市三级联动</div><div align="justify" style="min-height: 14pt;"><div style="margin-left:40px;"><b><font color="#333333" size="2"><span style="font-size:10pt">$.</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">ajax</span></font><font color="#333333" size="2"><span style="font-size:10pt">({  //json</span></font><font color="#333333" size="2"><span style="font-size:10pt">对象</span></font></b></div></div><div align="justify" style="min-height: 14pt;margin-left:40px;"><div><b><font color="#333333" size="2"><span style="font-size:10pt">       </span></font><font color="#FF0000" size="2"><span style="font-size:10pt">url</span></font><font color="#333333" size="2"><span style="font-size:10pt">:</span></font><font color="#333333" size="2"><span style="font-size:10pt">请求地址</span></font><font color="#333333" size="2"><span style="font-size:10pt">,</span></font></b></div></div><div align="justify" style="min-height: 14pt;margin-left:40px;"><div><b><font color="#333333" size="2"><span style="font-size:10pt">       [</span></font><font color="#FF0000" size="2"><span style="font-size:10pt">data]</span></font><font color="#333333" size="2"><span style="font-size:10pt">:</span></font><font color="#333333" size="2"><span style="font-size:10pt">给服务器传递的数据</span></font><font color="#333333" size="2"><span style="font-size:10pt">(</span></font><font color="#333333" size="2"><span style="font-size:10pt">请求字符串</span></font><font color="#333333" size="2"><span style="font-size:10pt">/json</span></font><font color="#333333" size="2"><span style="font-size:10pt">对象</span></font></b><font color="#333333" size="2"><span style="font-size:10pt"><b>)，必须键值对，<span style="color: rgb(255, 0, 0);">注意｛｝外无“”</span>，否则是字符串。</b></span></font></div></div><div align="justify" style="min-height: 14pt;margin-left:40px;"><div><b><font color="#333333" size="2"><span style="font-size:10pt">       [</span></font><font color="#FF0000" size="2"><span style="font-size:10pt">dataType]</span></font><font color="#333333" size="2"><span style="font-size:10pt">:</span></font><font color="#333333" size="2"><span style="font-size:10pt">默认字符串返回信息格式，数据从服务器返回格式</span></font><font color="#333333" size="2"><span style="font-size:10pt">html</span></font><font color="#333333" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" size="2"><span style="font-size:10pt">text</span></font><font color="#333333" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" size="2"><span style="font-size:10pt">xml</span></font><font color="#333333" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" size="2"><span style="font-size:10pt">json</span></font></b></div></div><div align="justify" style="min-height: 14pt;margin-left:40px;"><div><b><font color="#333333" size="2"><span style="font-size:10pt">       [</span></font><font color="#FF0000" size="2"><span style="font-size:10pt">type]</span></font><font color="#333333" size="2"><span style="font-size:10pt">:[get]/post</span></font><font color="#333333" size="2"><span style="font-size:10pt">请求方式</span></font></b></div></div><div align="justify" style="min-height: 14pt;margin-left:40px;"><div><b><font color="#333333" size="2"><span style="font-size:10pt">       [</span></font><font color="#FF0000" size="2"><span style="font-size:10pt">success]</span></font><font color="#333333" size="2"><span style="font-size:10pt">:function(</span><span style="font-size:10pt; background:#00ffff">msg</span><span style="font-size:10pt">){}  ajax</span></font><font color="#333333" size="2"><span style="font-size:10pt">成功请求后的回调函数，可以做后续处理使用</span></font></b></div></div><div align="justify" style="margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 14pt;margin-left:40px;"><div><b><font color="#333333" size="2"><span style="font-size:10pt">         其中msg</span></font><font color="#333333" size="2"><span style="font-size:10pt">泛指服务器返回来的信息,</span></font></b><b><font color="#333333" size="2"><span style="font-size:10pt">相当于</span></font><font color="#333333" size="2"><span style="font-size:10pt">readyState==4</span></font><font color="#333333" size="2"><span style="font-size:10pt">的处理逻辑函数部分</span></font></b></div></div><div align="justify" style="min-height: 14pt;margin-left:40px;"><div><b><font color="#333333" size="2"><span style="font-size:10pt">       async:[true]</span></font><font color="#333333" size="2"><span style="font-size:10pt">异步</span></font><font color="#333333" size="2"><span style="font-size:10pt">/false</span></font><font color="#333333" size="2"><span style="font-size:10pt">同步，</span></font></b></div></div><div align="justify" style="min-height: 14pt;margin-left:40px;"><div><b><font color="#333333" size="2"><span style="font-size:10pt">       cache:[true]</span></font><font color="#333333" size="2"><span style="font-size:10pt">缓存</span></font><font color="#333333" size="2"><span style="font-size:10pt">/false</span></font><font color="#333333" size="2"><span style="font-size:10pt">不缓存</span></font><font color="#333333" size="2"><span style="font-size:10pt">,</span></font></b></div><div><b><font color="#333333" size="2"><span style="font-size:10pt">});</span></font></b></div><div><span style="color: rgb(0, 0, 0); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 248); display: inline !important; float: none;">注意：其中data2种传参方式1是json格式，2是请求字符串形式</span></div><div><span style="color: rgb(0, 0, 0); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(248, 248, 248); display: inline !important; float: none;">1data: {</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: rgb(248, 248, 248); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">&quot;orderId&quot;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 0, 0); background-color: rgb(248, 248, 248); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">:orderId,</span><span style="margin: 0px; padding: 0px; border: none; color: blue; background-color: rgb(248, 248, 248); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">&quot;commant&quot;</span><span style="margin: 0px; padding: 0px; border: none; color: rgb(0, 0, 0); background-color: rgb(248, 248, 248); font-family: Consolas, &quot;Courier New&quot;, Courier, mono, serif; font-size: 12px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">:commant},2</span><span style="color: rgb(54, 46, 43); font-family: Arial; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); display: inline !important; float: none;">data: &quot;orderId=&quot; + orderId + &quot;&amp;commant=&quot; + commant</span></div></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 10pt;"><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">示例345：<b>Ajax无刷新表单提交+附件上传+进度条显示</b></span></span></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div>&lt;script type=&quot;text/javascript&quot;&gt;</div><div>        window.onload=function(){</div><div>            var fm=document.getElementsByTagName('form')[0];</div><div>            fm.onsubmit=function(evt){</div><div>                //1dom收集表单信息,利用FormData，this:在普通事件内部代表事件元素节点对象本身</div><div>                var fd=new FormData(this);//表单的全部信息已经收集给fd存储</div><div>                //2ajax传递收集的信息</div><div>                var xhr=new XMLHttpRequest();</div><div>                xhr.upload.onprogress=function(evt){</div><div><b>                    var total=evt.total;//已经上传文件大小</b></div><div><b>                    var loaded=evt.loaded;//附件总大小</b></div><div><b>                    var per=Math.floor((loaded/total)*100);//上传百分比</b></div><div>                    document.getElementById('du').innerHTML=per+&quot;%&quot;;</div><div>                    document.getElementById('du').style.width=per+&quot;%&quot;;</div><div>                }</div><div>                xhr.onreadystatechange=function(){</div><div>                    if (xhr.readyState==4) {</div><div>                        alert(xhr.responseText);</div><div>                    }</div><div>                }</div><div>                xhr.open('post','./json1.php');</div><div>                //使用FormData的时候，不用使用setRequestHeader()方法</div><div>                // xhr.setRequestHeader('content-type','application/x-www-form-urlencoded');</div><div>                xhr.send(fd);</div><div>                evt.preventDefault();//阻止form表单的提交动作</div><div>                }</div><div>        }</div><div>    &lt;/script&gt;</div></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">&lt;style type=&quot;text/css&quot;&gt;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        #jin{width:700px;height: 50px;border: 1px solid blue;}</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        #du{width:0;height:100%;background-color: green;}</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">&lt;/style&gt;</span></span></span></div></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">&lt;body&gt;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    &lt;form method=&quot;post&quot; action=&quot;./json1.php&quot;&gt;//可以直接写成&lt;form&gt;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        &lt;p&gt;名字&lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;mingzi&quot;&gt;&lt;/p&gt;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        &lt;p&gt;密码&lt;input type=&quot;password&quot; id=&quot;pass&quot; name=&quot;mima&quot;&gt;&lt;/p&gt;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        &lt;p&gt;邮箱&lt;input type=&quot;text&quot; id=&quot;email&quot; name=&quot;youxiang&quot;&gt;&lt;/p&gt;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        &lt;p&gt;文件&lt;input type=&quot;file&quot; id=&quot;file&quot; name=&quot;tupian&quot;&gt;&lt;/p&gt;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        &lt;div id=&quot;jin&quot;&gt;&lt;div id=&quot;du&quot;&gt;&lt;/div&gt;&lt;/div&gt;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">        &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;zhuce&quot;&gt;&lt;/p&gt;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">    &lt;/form&gt;</span></span></span></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);">&lt;/body&gt;</span></span></span></div></div><div>PHP接收和处理表单提交信息</div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>    print_r($_POST);</div><div>    print_r($_FILES);</div><div>    $dir=&quot;./upload/&quot;;</div><div>    $ext=substr($_FILES['tupian']['name'],strrpos($_FILES['tupian']['name'],'.'));</div><div>    $name=date(&quot;YmdHis&quot;).'-'.mt_rand(1000,9999);</div><div>    $dir_name=$dir.$name.$ext;</div><div>    // echo $dir_name;</div><div>    if (<b>move_uploaded_file($_FILES['tupian']['tmp_name'],$dir_name)</b>){</div><div>        echo &quot;Success&quot;;</div><div>    }else{</div><div>        echo &quot;Fail&quot;;</div><div>    }</div></div><div><b>5.1地市三级联动</b></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">&lt;title&gt;三级联动&lt;/title&gt;</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">    &lt;script type=&quot;text/javascript&quot; src=&quot;./jquery-1.4.4.js&quot;&gt;&lt;/script&gt;<b>//引入jQuery文件</b></span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">    &lt;script type=&quot;text/javascript&quot;&gt;</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        var xmlobj; //声明全局变量</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        <b>$.ajax({</b></span></span></div><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><b><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            url:'./ChinaArea.xml', //解析xml文件</span></span></b></span></div><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><b><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            type:'get',</span></span></b></span></div><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><b><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            dateType:'xml',</span></span></b></span></div><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><b><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            success:function(msg){</span></span></b></span></div><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><b><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">                xmlobj=msg;</span></span></b></span></div><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><b><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">                showprovince(); //引入成功后执行显示省份函数</span></span></b></span></div><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><b><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            }</span></span></b></span></div><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><b><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        });</span></span></b></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        // window.onload=function(){//javascript加载方法</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        //     $.ajax({</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        //         url:'./ChinaArea.xml',</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        //         type:'get',</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        //         dateType:'xml',</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        //         success:function(msg){</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        //             xmlobj=msg;</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        //             showprovince();</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        //         }</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        //     });</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        // ;}</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        // $(function(){//jQuery加载方法</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            // ajax代码</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        // });</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        function <b>showprovince()</b>{ //</span></span><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">获得全部省份的province元素节点，并遍历获得具体省份信息</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            $(xmlobj).find('province').each(function(){</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">                var prova=$(this).attr('province');</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">                var proid=$(this).attr('provinceID');</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">                $('#province').append(&quot;&lt;option value='&quot;+proid+&quot;'&gt;&quot;+prova+&quot;&lt;/option&gt;&quot;);//遍历赋值</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            });</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        }</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        function <b>showcity()</b>{     //根据选取的省份显示对应的城市信息</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            //获得被选中省份的id值</span></span> <span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">//根据pid获得对应的省份元素节点对象,进而获得其内部的City城市节点</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            var <b>pid</b>=$('#province option:selected').val();</span></span><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">       </span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            var <b>citys</b>=$(xmlobj).find(&quot;[provinceID=&quot;+pid+&quot;]&quot;).find('City');</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">  <b>          $('#city').empty();</b></span></span></div><div><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><b><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            $('#area').empty();//先清空</span></span></b></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            citys.each(function(){//遍历citys并显示城市信息</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">                var citva=$(this).attr('City');//this:分别依次代表每个city的dom对象</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">                var citid=$(this).attr('CityID');</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">                $('#city').append(&quot;&lt;option value='&quot;+citid+&quot;'&gt;&quot;+citva+&quot;&lt;/option&gt;&quot;);</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            });</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        }</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        function <b>showarea()</b>{     //获得地区信息</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            var cid=$('#city option:selected').val();</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            var areas=$(xmlobj).find(&quot;[CityID=&quot;+cid+&quot;]&quot;).find('Piecearea');   </span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            $('#area').empty();       </span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            areas.each(function(){</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">                var areava=$(this).attr('Piecearea');</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">                var areaid=$(this).attr('PieceareaID');</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">                $('#area').append(&quot;&lt;option value='&quot;+areaid+&quot;'&gt;&quot;+areava+&quot;&lt;/option&gt;&quot;);</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">            });</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">        }</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);">    &lt;/script&gt;</span></span></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);"><br/></span></span></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;body&gt;</div><div>    &lt;h2&gt;地市三级联动&lt;/h2&gt;</div><div>    省份：&lt;select id='province' onchange=&quot;showcity()&quot;&gt;&lt;option&gt;---&lt;/option&gt;&lt;/select&gt;</div><div>    城市：&lt;select id='city' onchange=&quot;showarea()&quot;&gt;&lt;option&gt;---&lt;/option&gt;&lt;/select&gt;</div><div>    区县：&lt;select id='area'&gt;&lt;option&gt;---&lt;/option&gt;&lt;/select&gt;</div><div>&lt;/body&gt;</div></div><div><span style="font-family: 'Courier New';"><span style="color: rgb(51, 51, 51);"><br/></span></span></div></div></div></span>
</div></body></html> 