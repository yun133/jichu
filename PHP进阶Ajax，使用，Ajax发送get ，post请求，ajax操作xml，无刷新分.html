<html>
<head>
  <title>PHP进阶Ajax，使用，Ajax发送get ，post请求，ajax操作xml，无刷新分页，取消缓存</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/303788 (zh-CN, DDL); Windows/6.1.7601 Service Pack 1 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2173"/>
<h1>PHP进阶Ajax，使用，Ajax发送get ，post请求，ajax操作xml，无刷新分页，取消缓存</h1>

<div>
<span><div><b><span style="font-size: 21px;">PHP进阶Ajax，使用，Ajax发送get ，post请求，ajax操作xml，无刷新分页，取消缓存</span></b></div><div align="justify" style="font-weight: bold;"><span style="font-size: 21px;"><b><font color="#333333"><b>一.什么是</b></font><font color="#333333">ajax</font></b></span></div><div align="justify" style="min-height: 14pt;"><div align="justify" style="min-height: 14pt;"><div align="justify" style="min-height: 14pt;"><div><span style="color: rgb(51, 51, 51);">        Asynchronous  Javascript And  XML</span></div><div><span style="color: rgb(51, 51, 51);">        异步javascript 和xml 是一种可以与服务器进行（异步/同步）交互的一种浏览器的技术</span></div><div><span style="color: rgb(51, 51, 51);">    Ajax的作用</span> <span style="color: rgb(51, 51, 51);">    </span></div><div><font color="#333333" size="2"><span style="font-size:10pt">        使用</span></font><font color="#333333" size="2"><span style="font-size:10pt">ajax</span></font><font color="#333333" size="2"><span style="font-size:10pt">的过程就是创建一个</span></font><font color="#333333" size="2"><span style="font-size:10pt">ajax</span></font><font color="#333333" size="2"><span style="font-size:10pt">对象，对象调用本身成员属性、成员方法的过程。</span></font></div><div><span style="color: rgb(51, 51, 51);">        <b>优点：节省带宽，节省用户等待时间，用户体验好</b></span></div><div><span style="color: rgb(51, 51, 51);">    Ajax的特点:</span><span style="color: rgb(51, 51, 51);">局部刷新,</span><span style="color: rgb(51, 51, 51);">逐步加载</span></div><div align="justify"><span style="font-size: 21px;"><b><b><font color="#333333">二．</font><font color="#333333">ajax</font></b><font color="#333333"><b>使用</b></font></b></span></div><div align="justify"><span style="font-size: 16px;"><b><b><font color="#333333">1.</font> <font color="#333333">创建</font></b><b><font color="#333333">ajax</font><font color="#333333">对象（xml核心技术）---</font></b></b><b><b><font color="#333333">主流浏览器方式</font></b></b></span></div><div align="justify" style="min-height: 12pt;"><div><span style="font-size: 16px;"><font color="#333333">var xhr =</font> <font color="#FF0000">new XMLHttpRequest</font><font color="#333333">();</font></span><font color="#333333" size="2"><span style="font-size:10pt">火狐、</span></font><font color="#333333" size="2"><span style="font-size:10pt">google</span></font><font color="#333333" size="2"><span style="font-size:10pt">、苹果</span></font><font color="#333333" size="2"><span style="font-size:10pt">safari</span></font><font color="#333333" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" size="2"><span style="font-size:10pt">opera</span></font><font color="#333333" size="2"><span style="font-size:10pt">包括</span></font><font color="#333333" size="2"><span style="font-size:10pt">IE7</span></font><font color="#333333" size="2"><span style="font-size:10pt">以上版本的浏览器</span></font></div></div><div><b><span style="font-size: 16px;"><span style="color: rgb(51, 51, 51);">2、Ajax的核心对象:</span><span style="color: rgb(51, 51, 51);">XMLHttpRequest</span></span></b></div><div><span style="color: rgb(51, 51, 51);">        属性:</span><span style="color: rgb(51, 51, 51);">readyState//ajax对象的状态</span></div><div><span style="color: rgb(51, 51, 51);">                0：ajax对象已创建</span></div><div><span style="color: rgb(51, 51, 51);">                1： 已调用open方法</span></div><div><span style="color: rgb(51, 51, 51);">                2：已调用send方法</span></div><div><span style="color: rgb(51, 51, 51);">                3：返回部分数据</span></div><div><span style="color: rgb(51, 51, 51);">                4：返回所有数据</span></div><div><span style="color: rgb(51, 51, 51);">            responseText:</span><span style="color: rgb(51, 51, 51);">返回值（字符串）</span></div><div><span style="color: rgb(51, 51, 51);">            responseXML:</span><span style="color: rgb(51, 51, 51);">返回XML DOM对象</span></div><div style="margin-left:40px;">status服务器返回的状态码200,304,403,404,500</div><div style="margin-left:40px;">statusText服务器返回的状态文本信息</div><div><span style="color: rgb(51, 51, 51);">        方法成员</span></div><div><span style="color: rgb(51, 51, 51);">            abort()//停止当前请求<br/></span></div><div><span style="color: rgb(51, 51, 51);">            open('get|post,url,[true,false]') 创建一个http请求</span></div><div><span style="color: rgb(51, 51, 51);">           </span> <span style="color: rgb(51, 51, 51);">send('get',null)或send('post',data);</span> <span style="color: rgb(51, 51, 51);">请求执行</span></div><div><span style="color: rgb(51, 51, 51);">            setRequestHeader()</span></div><div><span style="color: rgb(51, 51, 51);">            onreadystatechange()事件属性</span></div><div align="justify" style="min-height: 14pt;"><div><font color="#333333" size="2"><span style="font-size:10pt">浏览器可以接收的信息</span></font><font color="#FF0000" size="2"><span style="font-size:10pt">ajax</span></font><font color="#FF0000" size="2"><span style="font-size:10pt">都可以接收</span></font><font color="#333333" size="2"><span style="font-size:10pt">，例如字符串、</span></font><font color="#333333" size="2"><span style="font-size:10pt">html</span></font><font color="#333333" size="2"><span style="font-size:10pt">标签、</span></font><font color="#333333" size="2"><span style="font-size:10pt">css</span></font><font color="#333333" size="2"><span style="font-size:10pt">样式内容、</span></font><font color="#333333" size="2"><span style="font-size:10pt">xml</span></font><font color="#333333" size="2"><span style="font-size:10pt">内容、</span></font><font color="#333333" size="2"><span style="font-size:10pt">json</span></font><font color="#333333" size="2"><span style="font-size:10pt">内容等等。</span></font></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">    &lt;script type=&quot;text/javascript&quot;&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        function f1(){//ajax对服务器端发起请求</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            //1创建ajax对象</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            var xhr=new XMLHttpRequest();</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            //4设置事件，感知readState的状态变化，进而获得服务器返回信息</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            xhr.onreadystatechange=function(){</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                if (xhr.readyState==4) {</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    document.write(xhr.responseText);</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                }</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            }</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            //2创建一个新的http协议（请求）（打开浏览器、输入网址）</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            //xhr.open(请求方式get/post，url地址[，同步false/异步true]);</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            xhr.open('get','./Aptest.php?'+Math.random());</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            //3把http请求给发送出去</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            //xhr.send(null/post方式传送给服务器的数据)</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            xhr.send(null);</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        }</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">    &lt;/script&gt;</span></span></div></div><div style="box-sizing: border-box; padding: 8px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;">&lt;body&gt;</span></div><div><span style="font-size: 12px;">    &lt;h2&gt;ajax对服务器发起请求和接收服务器返回信息&lt;/h2&gt;</span></div><div><span style="font-size: 12px;">    &lt;input type=&quot;button&quot; value=&quot;触发&quot; onclick=&quot;f1()&quot;&gt;</span></div><div><span style="font-size: 12px;">&lt;/body&gt;</span></div></div></div><div><span style="font-size: 16px;"><b><span style="color: rgb(51, 51, 51);">3、Ajax发送GET请求的步骤</span></b></span></div><div><span style="color: rgb(51, 51, 51);">    1. 创建Ajax对象:</span><span style="color: rgb(51, 51, 51);">new XMLHttpRequest</span></div><div><span style="color: rgb(51, 51, 51);">    2. 初始化Ajax对象:</span><span style="color: rgb(51, 51, 51);">open()</span></div><div><span style="color: rgb(51, 51, 51);">    3. 发送请求:</span><span style="color: rgb(51, 51, 51);">send()</span></div><div><span style="color: rgb(51, 51, 51);">    4. 判断状态，处理数据:</span><span style="color: rgb(51, 51, 51);">onreadystatechange</span> <span style="color: rgb(51, 51, 51);">  readyState==4</span></div><div><b><span style="font-size: 16px;"><span style="color: rgb(51, 51, 51);">4、Ajax发送POST请求的步骤</span></span></b></div><div><span style="color: rgb(51, 51, 51);">    1. 创建Ajax对象：</span><span style="color: rgb(51, 51, 51);">new XMLHttpRequest</span></div><div><span style="color: rgb(51, 51, 51);">    2. 初始化Ajax对象：</span><span style="color: rgb(51, 51, 51);">open()</span></div><div><span style="color: rgb(51, 51, 51);">    <b>3. 设置请求头信息：</b></span><b><span style="color: rgb(51, 51, 51);">setRequestHeader()</span></b></div><div><b><span style="color: rgb(51, 51, 51);">            content-type，</span></b><span style="color: rgb(51, 51, 51);"><b>application/x-www-form-urlencoded</b></span></div><div><b><span style="color: rgb(51, 51, 51);">例：</span></b>xhr.setRequestHeader(&quot;content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);</div><div><span style="color: rgb(51, 51, 51);">    4. 发送请求：</span><span style="color: rgb(51, 51, 51);">send</span></div><div><span style="color: rgb(51, 51, 51);">    5. 判断状态， 处理数据：</span><span style="color: rgb(51, 51, 51);">onreadystatechange      </span><span style="color: rgb(51, 51, 51);">readyState==4</span></div><div style="box-sizing: border-box; padding: 8px; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div>&lt;script type=&quot;text/javascript&quot;&gt;</div><div>        function checkname(){</div><div>            //ajax方式校验用户名 ，//A. 获得被校验的用户名信息</div><div>            var nm = document.getElementById('username').value;</div><div>            //对 &amp; 、= 等符号需要进行特殊处理，否则产生歧义</div><div>            nm = encodeURIComponent(nm);//encodeURIComponent()可以对特殊符号进行处理</div><div>            //把需要传递的信息变为&quot;请求字符串&quot;格式，并设置为send()方法参数</div><div>            var info = &quot;name=&quot;+nm+&quot;&amp;age=20&quot;;</div><div>            //B. ajax带着该名字信息去服务器端校验</div><div>            var xhr = new XMLHttpRequest();//一</div><div>            xhr.onreadystatechange = function(){//五</div><div>                if(xhr.readyState==4){</div><div>                    alert(xhr.responseText);</div><div>                }</div><div>            }</div><div>            //post方式传递数据是模拟form表单方式传递数据</div><div>            //form表单的数据实际是组织为xml格式传递给服务器端的</div><div>            xhr.open('post','./06.php?color=red');//二</div><div>            //设置http头协议，把传递的post //数据组织为xml格式</div><div>            //注意：setRequestHeader方法必须在open方法后边调用</div><div>            xhr.setRequestHeader(&quot;content-type&quot;,&quot;application/x-www-form-urlencoded&quot;);//三</div><div>            xhr.send(info);//四</div><div>        }</div><div>&lt;/script&gt;</div></div><div><span style="color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-size: 19px;"><b><span style="color: rgb(51, 51, 51);">三、发送带参数的请求</span></b></span></div><div><span style="color: rgb(51, 51, 51);">    GET请求：</span><span style="color: rgb(51, 51, 51);">参数写在URL地址后面。2k，安全性低，地址栏提交</span></div><div><span style="color: rgb(51, 51, 51);">    POST请求：</span><span style="color: rgb(51, 51, 51);">参数单独组织，通过send方法发送。<b>数据大小</b>理论无限制，<b>安全性</b>更高，form表单<b>提交方式</b></span></div><div align="justify" style="min-height: 14pt;"><b><font color="#333333" size="2"><span style="font-size:10pt">ajax</span></font><font color="#333333" size="2"><span style="font-size:10pt">之</span></font><font color="#333333" size="2"><span style="font-size:10pt">get</span></font><font color="#333333" size="2"><span style="font-size:10pt">请求需要注意的两个地方：</span></font></b><font color="#333333" size="2"><span style="font-size:10pt"> </span></font></div><div align="justify" style="min-height: 14pt;"><font color="#333333" size="2"><span style="font-size:10pt">①在</span></font><font color="#333333" size="2"><span style="font-size:10pt">url</span></font><font color="#333333" size="2"><span style="font-size:10pt">地址后边以</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">请求字符串</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">(</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">传递的</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">get</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">参数信息</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">)</span></font><font color="#333333" size="2"><span style="font-size:10pt">形式传递数据。</span></font></div><div align="justify" style="min-height: 14pt;"><div><font color="#333333" size="2"><span style="font-size:10pt">②</span></font> <font color="#333333" size="2"><span style="font-size:10pt">对</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">中文</span></font><font color="#333333" size="2"><span style="font-size:10pt">、</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">=</span></font><font color="#333333" size="2"><span style="font-size:10pt">、</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">&amp;</span></font><font color="#333333" size="2"><span style="font-size:10pt">等特殊符号处理</span></font></div></div><div align="justify" style="margin-left:0mm; margin-right:0mm; text-indent:7mm; margin-top:0.00mm; margin-bottom:0.00mm;min-height: 14pt;"><div><font color="#333333" size="2"><span style="font-size:10pt">=</span></font><font color="#333333" size="2"><span style="font-size:10pt">、</span></font><font color="#333333" size="2"><span style="font-size:10pt">&amp;</span></font><font color="#333333" size="2"><span style="font-size:10pt">符号在浏览器里边会与请求字符串的关键符号有混淆，避免歧义产生需要对其进行编码</span></font><font color="#333333" size="2"><span style="font-size:10pt">.</span></font></div></div><div align="justify" style="min-height: 13pt;"><font color="#333333" size="2"><span style="font-size:10pt">对特殊信息的处理：</span></font></div><div align="justify" style="min-height: 14pt;"><div style="margin-left:40px;"><font color="#333333" size="2"><span style="font-size:10pt">在浏览器的地址栏里边传递一些特殊符号信息，会被误解，例如</span></font> <font color="#0000FF" size="2"><span style="font-size:10pt">&amp;  = </span></font> <font color="#0000FF" size="2"><span style="font-size:10pt">空格</span></font><font color="#0000FF" size="2"><span style="font-size:10pt"> </span></font> <font color="#0000FF" size="2"><span style="font-size:10pt">中文</span></font><font color="#333333" size="2"><span style="font-size:10pt">等。</span></font></div></div><div align="justify" style="min-height: 14pt;margin-left:40px;"><div><font color="#333333" size="2"><span style="font-size:10pt">①．在</span></font><font color="#333333" size="2"><span style="font-size:10pt">php</span></font><font color="#333333" size="2"><span style="font-size:10pt">里边可以函数</span></font> <b><font color="#FF0000" size="2"><span style="font-size:10pt">urlencode()</span></font><font color="#333333" size="2"><span style="font-size:10pt">/</span></font><font color="#FF0000" size="2"><span style="font-size:10pt">urldecode()</span></font></b><font color="#333333" size="2"><span style="font-size:10pt">对特殊符号进行编码、反编码处理</span></font></div></div><div align="justify" style="min-height: 14pt;margin-left:40px;"><div><font color="#333333" size="2"><span style="font-size:10pt">(url_encode()</span></font><font color="#333333" size="2"><span style="font-size:10pt">可以把中文转变为浏览器可以识别的信息。转变之后的信息具体为</span></font><font color="#333333" size="2"><span style="font-size:10pt">%</span></font><font color="#333333" size="2"><span style="font-size:10pt">号后接两个十六进制数</span></font><font color="#333333" size="2"><span style="font-size:10pt">)</span></font></div></div><div align="justify" style="min-height: 14pt;margin-left:40px;"><div><font color="#333333" size="2"><span style="font-size:10pt">②．在</span></font><b><font color="#333333" size="2"><span style="font-size:10pt">javascript</span></font></b><font color="#333333" size="2"><span style="font-size:10pt">里边可以通过</span></font><b><font color="#FF0000" size="2"><span style="font-size:10pt">encodeURIComponent</span></font> <font color="#333333" size="2"><span style="font-size:10pt">()</span></font></b><font color="#333333" size="2"><span style="font-size:10pt">对特殊符号等信息进行编码。</span></font></div></div><div align="justify" style="min-height: 14pt;"><div style="margin-left:40px;"><font color="#333333" size="2"><span style="font-size:10pt">(</span></font><font color="#333333" size="2"><span style="font-size:10pt">经过以上</span></font><font color="#FF0000" size="2"><span style="font-size:10pt">红色</span></font><font color="#333333" size="2"><span style="font-size:10pt">函数编码的内容在服务器端可以正常接收，不需要反编码</span></font><font color="#333333" size="2"><span style="font-size:10pt">)</span></font></div></div><div><span style="font-size: 19px;"><b><span style="color: rgb(51, 51, 51);">四、无刷新分页（详见例）</span></b></span></div><div><span style="font-size: 16px;"><b><font color="#333333"><b>什么时候使用同步请求？</b></font></b></span></div><div align="justify" style="font-size: 15px;"><font color="#333333" size="2"><span style="font-size:10pt">ajax</span></font><font color="#333333" size="2"><span style="font-size:10pt">绝大多数情况下进行</span></font><font color="#FF0000" size="2"><span style="font-size:10pt">异步</span></font><font color="#333333" size="2"><span style="font-size:10pt">请求，但是有的时候也要使用“同步请求”</span></font><font color="#333333" size="2"><span style="font-size:10pt">(</span></font><font color="#333333" size="2"><span style="font-size:10pt">其不能被取代</span></font><font color="#333333" size="2"><span style="font-size:10pt">)</span></font><font color="#333333" size="2"><span style="font-size:10pt">。例如页面有两部分内容，</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">ajax</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">请求内容</span></font><font color="#333333" size="2"><span style="font-size:10pt">和</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">正常的</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">html</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">内容输出</span></font><font color="#333333" size="2"><span style="font-size:10pt">，如果</span></font><font color="#333333" size="2"><span style="font-size:10pt">html</span></font><font color="#333333" size="2"><span style="font-size:10pt">的输出内容包括</span></font><font color="#333333" size="2"><span style="font-size:10pt">ajax</span></font><font color="#333333" size="2"><span style="font-size:10pt">请求的内容，就需要使得</span></font><font color="#333333" size="2"><span style="font-size:10pt">ajax</span></font><font color="#333333" size="2"><span style="font-size:10pt">请求完成了再进行</span></font><font color="#333333" size="2"><span style="font-size:10pt">html</span></font><font color="#333333" size="2"><span style="font-size:10pt">内容的输出，这样就要设置两者一前一后调用</span></font><font color="#333333" size="2"><span style="font-size:10pt">(</span></font><font color="#333333" size="2"><span style="font-size:10pt">而非同时调用</span></font><font color="#333333" size="2"><span style="font-size:10pt">)</span></font><font color="#333333" size="2"><span style="font-size:10pt">，既要进行</span></font><font color="#0000FF" size="2"><span style="font-size:10pt">同步请求</span></font><font color="#333333" size="2"><span style="font-size:10pt">。</span></font></div><div><span style="color: rgb(51, 51, 51);">    <b>1、分页原理</b></span></div><div><span style="color: rgb(51, 51, 51);">        通过不同的url将页面参数解析成对应的SQL语句</span></div><div><span style="color: rgb(51, 51, 51);">            1.1、limit offset, num</span></div><div><span style="color: rgb(51, 51, 51);">           </span> <span style="color: rgb(51, 51, 51);">1.2、</span><span style="color: rgb(51, 51, 51);">(current_page -1) * page_size = offset</span></div><div><span style="color: rgb(51, 51, 51);">                1.2.1、current_page: 当前的页码</span></div><div><span style="color: rgb(51, 51, 51);">               </span> <span style="color: rgb(51, 51, 51);">1.2.2、</span><span style="color: rgb(51, 51, 51);">page_size: 每页显示的数目</span></div><div><span style="color: rgb(51, 51, 51);">               </span> <span style="color: rgb(51, 51, 51);">1.2.3、</span><span style="color: rgb(51, 51, 51);">offset：偏移量</span></div><div><span style="color: rgb(51, 51, 51);">               </span> <span style="color: rgb(51, 51, 51);">1.2.4、</span><span style="color: rgb(51, 51, 51);">page_size == num</span></div><div><span style="color: rgb(51, 51, 51);">    <b>2、Ajax端</b></span></div><div><span style="color: rgb(51, 51, 51);">        发送带页面参数的GET请求</span></div><div><span style="color: rgb(51, 51, 51);">  <b>  3、PHP端</b></span></div><div><span style="color: rgb(51, 51, 51);">        根据页面参数解析SQL语句</span></div><div><span style="color: rgb(51, 51, 51);">        修改分页链接</span></div><div><b><span style="font-size: 19px;"><span style="color: rgb(51, 51, 51);">五、ajax操作xml</span></span></b></div><div><span style="color: rgb(51, 51, 51);">    ajax负责请求xml  dom操作xml，<b>详见</b></span><b>天气预报案例5.1<span style="color: rgb(51, 51, 51);">：</span></b></div><div><span style="color: rgb(51, 51, 51);">     <b>xml数据接收处理：getElementByTagName(),childNodes,length,tagName,nodeValue,nodeType</b><br/></span></div><div><b><span style="font-size: 19px;"><span style="color: rgb(51, 51, 51);">六、ajax缓存(针对IE浏览器)</span></span></b></div><div><span style="color: rgb(51, 51, 51);">    添加随机数xhr.open('get',',/10.php?'+Math.random());   </span></div><div><span style="color: rgb(51, 51, 51);">    设置header头//三条header语句是为兼容</span></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">header(&quot;Cache-Control:no-cache&quot;);</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">header(&quot;Pragma:no-cache&quot;);</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">header(&quot;Expires:-1&quot;);</span></span></div></div><div><b>5.1ajax+js实现xml的接收和处理（天气预报案例）</b></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">&lt;script type=&quot;text/javascript&quot;&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        function f1(){</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            //ajax请求xml信息回来 ，//dom处理xml信息(dom方式对xml的处理与html处理完全一致)</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            var xhr = new XMLHttpRequest();</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            xhr.onreadystatechange = function(){</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                if(xhr.readyState==4){</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    //alert(typeof xhr.responseText); //以“字符串”形式返回xml信息</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    //以“xmldocment文档节点对象”形式返回xml信息，进而可以通过dom方式处理xml</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    //alert(typeof xhr.responseXML);// xml根节点的父级节点对象</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    //console.log(xhr.responseXML);//xmlDocument</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    var xmldom = xhr.responseXML;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    //console.log(xmldom.firstChild);//&lt;weather&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    var citys = xmldom.getElementsByTagName('city');//三个city</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    //console.log(citys);//HTMLCollection[city, city, city]</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    //遍历当前citys[1]的&quot;元素节点&quot;对象</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    //getElementsByTagName()方法可以被“document”或“元素节点”对象调用</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    //for(var k in citys[1]){</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    //    console.log(k);</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    //}</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    var s = &quot;&quot;;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    for(var i=0; i&lt;citys.length; i++){</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                        var nm = citys[i].getElementsByTagName('name')[0].firstChild.nodeValue;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                        var tp = citys[i].getElementsByTagName('temp')[0].firstChild.nodeValue;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                        var wd = citys[i].getElementsByTagName('wind')[0].firstChild.nodeValue;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                        s += &quot;城市：&quot;+nm+&quot;-温度：&quot;+tp+&quot;-风向：&quot;+wd+&quot;&lt;br /&gt;&quot;;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    }</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                    document.getElementById('result').innerHTML = s;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">                }</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            }</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            xhr.open('get','./09-weather.xml');</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">            xhr.send(null);</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        }</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;/script&gt;</span></span></div></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">&lt;body&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;h2&gt;ajax+js实现xml的接收和处理&lt;/h2&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;input type=&quot;button&quot; value=&quot;触发&quot; onclick=&quot;f1()&quot; /&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;div id=&quot;result&quot;&gt;&lt;/div&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">    &lt;/body&gt;</span></span></div></div><div style="box-sizing: border-box; padding: 8px; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);"><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">&lt;weather&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">    &lt;city&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;name&gt;北京&lt;/name&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;temp&gt;15~20&lt;/temp&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;wind&gt;北风&lt;/wind&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">    &lt;/city&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">    &lt;city&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;name&gt;上海&lt;/name&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;temp&gt;18~22&lt;/temp&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;wind&gt;海风&lt;/wind&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">    &lt;/city&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">    &lt;city&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;name&gt;深圳&lt;/name&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;temp&gt;19~25&lt;/temp&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">        &lt;wind&gt;南风&lt;/wind&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">    &lt;/city&gt;</span></span></div><div><span style="font-size: 12px;"><span style="color: rgb(51, 51, 51);">&lt;/weather&gt;</span></span></div></div></div></div></div></span>
</div></body></html> 